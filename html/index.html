<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="../style/style.css">

    <title>Group6</title>
    <script type="text/javascript" src="../d3.js"></script>
</head>
<body>
<h1>Insert Title Here</h1>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar">
        <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="#">Group6</a>

    <div class="collapse navbar-collapse" id="navbar">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item">
                <a class="nav-link" href="index.html">Home<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="health.html">Health Expenditure</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="death.html">Death Causes</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="smoking.html">Smoking Status</a>
            </li>
        </ul>
    </div>
</nav>


<!--TODO : cancellare bordi e fare script con dimensioni (si adattano)-->

<div class="container-fluid">
    <div class="row" >
        <div class="col" style="border: black solid 1px; text-align: center;">
            <svg id="map" style="border: black solid 1px"></svg>
        </div>
    </div>

</div>




<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    //1.set dimensions of svg
    const wsvg = 80;//using percentage relative to the container div
    const hsvg = 80;//using percentage relative to the container div

    //2.set dimensions within svg following Mike Bostok's convention
    const wtot = 1600;
    const htot = 900;
    const margin = { top: 100, right: 80, bottom: 90, left: 80 },
        width = wtot - margin.left - margin.right,
        height = htot - margin.top - margin.bottom;

    //append the svg object to the body of the page
    const svg = d3.select("#map")
        .attr("width", wsvg + "%")
        .attr("height", hsvg + "%")
        .attr("viewBox", "0 0 " + wtot + " " + htot)
        .append("g")
        .attr("transform",
            `translate(${margin.left},${margin.top})`);


    // Map and projection
    //const path = d3.geoPath();
    const projection = d3.geoMercator()
        .scale(3000)
        .center([12,42])
        .translate([width / 2, height / 2]);

    const path = d3.geoPath().projection(projection);

    // Data and color scale
    let data = new Map()

    const colorScale = d3.scaleThreshold()
        .domain([100000, 2120000, 4140000, 6160000, 8180000, 10000000])
        .range(d3.schemeBlues[7]);

    // Load external data and boot
    Promise.all([
        d3.json("../assets/home/limits_IT_regions.geojson"),
        d3.csv("../assets/home/2020.csv", function(d) {
            data.set(d.Region, +d.Total)
        })
    ]).then(function(loadData){
        let topo = loadData[0]

        // Draw the map
        svg.append("g")
            .selectAll("path")
            .data(topo.features)
            .join("path")
            // draw each region
            .attr("d", path)
            // set the color of each region
            .attr("fill", function (d) {
                d.total = data.get(d.properties.reg_name) || 0;
                return colorScale(d.total);
            })
    })

</script>
</body>
</html>